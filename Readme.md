# Хавронич Евгений Алексеевич, БПИ226
---
## Данное приложение разработано для управления заказами в ресторане, которое поддерживает два типа пользователей: посетителей и администраторов. Система обрабатывает заказы в многопоточном режиме, позволяя клиентам добавлять блюда в заказ в реальном времени, а также отображает статусы заказов при помощи оплаты. Администраторы могут управлять меню, добавляя или удаляя блюда. Все решения соблюдают принципы ООП и SOLID, а также используются шаблоны проектирования, где это уместно.
### Как пользоваться приложением
Необходимо в resources/application.properties изменить db.pass и db.name на соответствующие для успешного входа в локальную базу данных postgres.
После этого нужно запустить [Appication.kt](src/main/kotlin/Application.kt), после чего отправлять соответствующие запросы через postMan
#### Регистрация и авторизация
Для регистрации необходимо отправить post запрос на хост http://localhost:8080/registration с телом формата
{
"login": "Jhon",
"password": "jekosmo",
"role": false
}
где вводится логин, пароль и true, если регистрируется администратор, false, если посетитель. В ответ от сервера поступает сообщение об успешной регистрации – иначе сообщение об ошибке.

Для авторизации необходимо отправить post запрос на хост http://localhost:8080/login с телом формата
{
"login": "Jhon",
"password": "jekosmo"
}
где указаны логин и пароль уже ранее зарегистрированного в системе пользователя. В ответ сервер выдаёт токен текущей сессии данного пользователя, который используется далее во всех остальных запросов с параметром token, иначе же выдаётся сообщение об ошибке.

#### Действия администратора

1. Добавление блюда в меню
Для добавления в меню блюда необходимо отправить post запрос на хост http://localhost:8080/addMealToMenu с телом формата
{
"token" : 757956635,
"dishName" : "cheeseCake",
"price" : 250,
"cookingTime" : 10,
"amount" : 4
}
где указаны токен сессии администратора, название блюда, цена, время готовки (в секундах), количество этого блюда в наличии. В ответ поступает сообщение об успехе/неуспехе операции

2. Удаление блюда из меню

Для удаления блюда из меню необходимо отправить post запрос на хост http://localhost:8080/removeDishFromMenu с телом формата
{
"token" : 757956635,
"name":"cheeseCake"
}
где указаны токен сессии администратора и название блюда, которое нужно удалить. В ответ поступает сообщение об успехе/неуспехе

3. Увеличение количества блюд

Для увеличения количества блюда из меню необходимо отправить post запрос на хост http://localhost:8080/increaseMealAmount с телом формата
{
"token" : 69673129,
"meal" : "cheeseCake",
"amount" : 3
}
где указаны токен сессии администратора, название блюда, и насколько нужно увеличить количество порций. В ответ поступает сообщение об успехе/неуспехе

4. Изменение цены блюда

Для изменения цены блюда из меню необходимо отправить post запрос на хост http://localhost:8080/changeMealPrice с телом формата
{
"token": 132875938,
"dish" : "cheeseCake",
"price" : 150
}
где указаны токен сессии администратора, название блюда, и новая цена блюда. В ответ поступает сообщение об успехе/неуспехе

5. Получение суммы выручки

Для получения суммы выручки необходимо отправить post запрос на хост http://localhost:8080/getIncome с телом формата
{
"token": 132875938
}
где указан токен сессии администратора. В ответ поступает сообщение с выручкой за все дни или сообщение о неуспехе

6. Получение информации об активности пользователей

Для получения информации об активности пользователей необходимо отправить post запрос на хост http://localhost:8080/getUserActivity с телом формата
{
"token": 132875938
}
где указан токен сессии администратора. В ответ поступает сообщение с всей активность пользователей за все дни или сообщение о неуспехе

#### Действия посетителя

1. Добавление блюда в заказ

Для добавления блюда в заказ необходимо отправить post запрос на хост http://localhost:8080/orderMeal с телом формата
{
"token" : 757956635,
"name":"cheeseCake"
}
где указаны токен сессии посетителя и название блюда, которое нужно добавить в заказ. В ответ поступает сообщение об успехе/неуспехе. Добавляется каждое блюдо поединично.

2. Удаление блюда из заказа

Для удаления блюда из заказа необходимо отправить post запрос на хост http://localhost:8080/removeDishFromOrder с телом формата
{
"token" : 757956635,
"name":"cheeseCake"
}
где указаны токен сессии посетителя и название блюда, которое нужно удалить из заказа. В ответ поступает сообщение об успехе/неуспехе.

3. Отправка заказа на приготовление

Для отправки заказа на приготовление необходимо отправить post запрос на хост http://localhost:8080/putOrder с телом формата
{
"token": 132875938
}
где указан токен сессии посетителя. В ответ поступает сообщение об успехе/неуспехе

4. Отмена заказа

Для отмены заказа необходимо отправить post запрос на хост http://localhost:8080/cancelOrder с телом формата
{
"token": 132875938
}
где указан токен сессии посетителя. В ответ поступает сообщение об успехе/неуспехе

5. Оплата заказа

Для оплаты заказа необходимо отправить post запрос на хост http://localhost:8080/pay с телом формата
{
"token" : 669094881,
"cardNumber" : 32423433
}
где указан токен сессии посетителя и номер карты (проверяется системой). В ответ поступает сообщение об успехе/неуспехе

#### Доступное всем ролям

1. Получение меню

Для получение меню необходимо отправить get запрос на хост http://localhost:8080/menu.
В ответ поступает меню или сообщение об ошибке.

2. Выход из системы

Для выхода из системы необходимо отправить post запрос на хост http://localhost:8080/logout с телом формата
{
"token" : 939275846
}
где указан токен текущей сессии. В ответ поступает сообщение об успехе/неуспехе

#### Хранение данных
Данные хранятся в виде таблиц в базе данных Postgressql.

#### О программе.
Где вводятся числовые запросы – необходимо вводить исключительно неотрицательные числа. В стандартном приложении этим бы занимался front.
Внутри программы используется адаптер, как один из взятых шаблонов проектирования, а именно DataBaseAdapter. Он позволяет легко обращаться системе к тем или иным данным внутри таблиц, располагающихся в базе данных, скрывая лишние связи и запросы, которые там используются.

Также используются синглтоны, а именно сущности, помеченные, как object. А именно AuthManager, DataBaseAdapter и PaySystem. Нужно это для того, чтобы обращаться к свойствам и методам одного и того же объекта из разных участков кода.

Также используется состояния – в нашем случае это BeforeCookingState AfterCookingState, CookingState, которые являются реализациями интерфейса orderState. Они позволяют по-разному отвечать на вызове внешней среды относительно состояния заказа.

Тем самым у нас есть:

Cистему аутентификации для двух типов пользователей: посетителей и администраторов.

Администратор может добавлять и удалять блюда из меню, а также устанавливать их количество, цену и сложность выполнения (время, которое оно будет готовиться).

Посетители могут составлять заказ, выбирая блюда из актуального меню.

Заказы обрабатываются в отдельных потоках, симулируя процесс приготовления.

Посетители могут добавлять блюда в существующий заказ, пока он находится в обработке.

Посетители имеют возможность отменять заказ до того, как он будет готов.

Система должна отображать актуальный статус заказа. Это при оплате.

По завершению выполнения заказа посетитель имеет возможность его оплатить.

Сохраняются состояния программы: меню, сумма выручки, пользователи в системе.
